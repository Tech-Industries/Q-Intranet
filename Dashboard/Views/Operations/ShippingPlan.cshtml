
@{
    ViewBag.Title = "Shipping Plan";
}

<h2>Shipping Plan</h2>
<div class="row">
    <div class="col-md-12">
        <div class="ibox float-e-margins">
            <div class="ibox-content">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover dtShippingPlan">
                        <thead>
                            <tr>
                                <th class="hidden">ID</th>
                                <th>OrderNo</th>
                                <th>OrderLine</th>
                                <th>Customer</th>
                                <th>Name</th>
                                <th>Part</th>
                                <th>Description</th>
                                <th>Qty</th>
                                <th>Price</th>
                                <th>Sale</th>
                                <th>DateDue</th>
                                <th>Adj. Ship Date</th>
                                <th class="hidden">DateID</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script src="~/Scripts/KO-Models/ko-model-operations.js"></script>

    <script>

        $(function () {

            var vm = new OperationsViewModel();
            ko.applyBindings(vm);
            vm.loadData();

            var table = $('.dtShippingPlan').DataTable({
                "createdRow": function (row, data, index) {
                    $('td', row).eq(0).addClass("hidden");
                    $('td', row).eq(12).addClass("hidden");
                    $('td', row).eq(7).addClass("dtRightAlign");
                    $('td', row).eq(8).addClass("dtRightAlign");
                    $('td', row).eq(9).addClass("dtRightAlign");
                    var date = $('td', row).eq(11).html();
                    if (date == '01/01/1900') {
                        $('td', row).eq(11).html('<span class="adj-date-update"></span><div class="input-group date" data-provide="datepicker"><input type="text" class="hidden form-control adj-ship-date" readonly><div class="input-group-addon"><i class="fa fa-calendar"></i></div></div>');
                    }
                    else {
                        $('td', row).eq(11).html('<span class="adj-date-update">' + date + '</span><div class="input-group date" data-provide="datepicker"><input type="text" class="hidden form-control adj-ship-date" value="' + date + '" readonly><div class="input-group-addon"><i class="fa fa-calendar"></i></div></div>');
                    }
                }
            });

            $(document).on('change', '.adj-ship-date', function () {
                var ID = $(this).parent().parent().parent().children().first().html();
                var newDate = $(this).val();
                if($(this).parent().parent().children().first().html() == ''){
                    vm.AddAdjShipDate(ID, newDate, this);
                    
                }
                else {
                    DateID = $(this).parent().parent().next().html();
                    vm.UpdateAdjShipDate(ID, DateID, newDate);
                }
                $(this).parent().parent().children().first().html(newDate);
            });
        });
    </script>
}
